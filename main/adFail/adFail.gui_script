local druid = require("druid.druid")
local events = require("event.events")
local gameEvents = require("main/events/gameEvents")
local translator = require("main/translator/translator")

local function onContinueBtn(self)
	gui.set_enabled(self.panel, false)
	events.trigger(gameEvents.HIDE_FAILED_PANEL)
	self.input_enabled = false
end

local function onShowFailedPanel(self)
	gui.set_enabled(self.panel, true)
	self.input_enabled = true
end

local function translate()
	translator.translate({
		{node = "title", textId = "IDS_ADFAIL_TITLE"},
		{node = "description", textId = "IDS_ADFAIL_DESC"},
		{node = "continueBtnText", textId = "IDS_CONTINUE"},
	})
end


function init(self)
	self.druid = druid.new(self)
	self.input_enabled = false
	

	self.panel = gui.get_node("panel")
	self.continueBtn = self.druid:new_button("continueBtn", onContinueBtn)

	events.subscribe(gameEvents.SHOW_FAILED_PANEL, onShowFailedPanel, self)
	events.subscribe(gameEvents.LANG_CHANGED,translate)

	gui.set_render_order(2)
	translate();
end

function final(self)
	self.druid:final()

	events.unsubscribe(gameEvents.SHOW_FAILED_PANEL, onShowFailedPanel, self)
	events.unsubscribe(gameEvents.LANG_CHANGED,translate)
end

function update(self, dt)
	self.druid:update(dt)
end

function on_message(self, message_id, message, sender)
	self.druid:on_message(message_id, message, sender)
end

function on_input(self, action_id, action)
	if not self.input_enabled then 
		return false
	end
	return self.druid:on_input(action_id, action)
end

function on_reload(self)

end
